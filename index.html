<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-512.png">
    <title>Ëã±ÂçòË™û„Éû„Çπ„Çø„Éº Pro („Éç„Ç§„ÉÜ„Ç£„ÉñÈü≥Â£∞Âº∑ÂåñÁâà)</title>
    <style>
        :root { --primary: #4CAF50; --bg: #eef2f3; --review: #f39c12; --listen: #9b59b6; --time: #e74c3c; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; position: relative; z-index: 20; }
        .header-controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 1rem; }
        .top-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .mode-selector { display: flex; background: #ddd; border-radius: 12px; padding: 4px; gap: 4px; flex-grow: 1; }
        .mode-option { flex: 1; padding: 8px 5px; font-size: 0.8rem; border-radius: 8px; cursor: pointer; font-weight: bold; color: #666; transition: 0.3s; }
        .mode-option.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #time-tri-btn { font-size: 1.4rem; padding: 2px 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        #time-tri-btn.active { color: var(--time); background: #ffdada; animation: pulse 1.5s infinite; border-radius: 8px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .timer-display { font-size: 1.4rem; font-weight: bold; color: var(--time); visibility: hidden; min-width: 70px; }
        .highscore-display { font-size: 0.85rem; color: #7f8c8d; margin-top: 5px; background: #f9f9f9; padding: 4px; border-radius: 8px; }
        .word-display { font-size: 2.5rem; font-weight: bold; margin-bottom: 1rem; color: #2c3e50; min-height: 3.5rem; display: flex; justify-content: center; align-items: center; }
        .options-grid { display: grid; gap: 10px; }
        .option-btn { padding: 16px; border: 2px solid #ddd; border-radius: 12px; background: white; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .option-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        #spell-input-area { display: none; }
        #spell-input { width: 85%; padding: 14px; font-size: 1.4rem; border: 2px solid #ddd; border-radius: 12px; text-align: center; margin-bottom: 10px; }
        .hint-btn { background: none; border: 1px solid #aaa; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; color: #666; margin-bottom: 10px; }
        .speaker-btn { background: #f0f0f0; border: 2px solid #ddd; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; }
        .btn-main { padding: 15px 25px; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 12px; width: 100%; margin-top: 20px; font-size: 1.2rem; font-weight: bold; }
        #feedback { margin-top: 10px; font-weight: bold; min-height: 24px; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="card" id="game-card">
    <div id="game-content">
        <div class="header-controls">
            <div class="top-row">
                <div class="mode-selector">
                    <div class="mode-option active" onclick="changeMode('choice')">4Êäû</div>
                    <div class="mode-option" onclick="changeMode('spell')">Êõ∏„Åè</div>
                    <div class="mode-option" onclick="changeMode('listen')">ËÅû„Åè</div>
                    <div class="mode-option" id="time-tri-btn" onclick="toggleTimeTrial()">‚è±</div>
                </div>
                <div id="timer" class="timer-display">10:00</div>
            </div>
            <div class="highscore-display">ÊúÄÈ´òË®òÈå≤: <span id="high-score">0</span></div>
        </div>
        <div class="score-board" style="color:#7f8c8d; margin-bottom:5px; font-size: 1rem; font-weight: bold;">
            „Çπ„Ç≥„Ç¢: <span id="score" style="color:var(--primary);">0</span>
        </div>
        <div class="word-display"><span id="target-display">Start!</span></div>
        
        <button id="speaker-icon" class="speaker-btn" onclick="retrySpeak()">üîä</button>
        
        <div class="options-grid" id="options"></div>
        
        <div id="spell-input-area">
            <input type="text" id="spell-input" placeholder="„Çπ„Éö„É´„ÇíÂÖ•Âäõ..." autocomplete="off">
            <br>
            <button class="hint-btn" onclick="showHint()">üí° „Éí„É≥„Éà</button>
            <div id="hint-text" style="font-size: 0.9rem; color: #f39c12; letter-spacing: 2px; height: 20px;"></div>
        </div>
        
        <div id="feedback"></div>
    </div>
</div>

<script>
    const masterWordList = [
                      { en: "Hello", ja: "„Åì„Çì„Å´„Å°„ÅØ" },
        { en: "Thank you", ja: "„ÅÇ„Çä„Åå„Å®„ÅÜ" },
        { en: "Excuse me", ja: "„Åô„Åø„Åæ„Åõ„Çì" },
        { en: "I'm sorry", ja: "„Åî„ÇÅ„Çì„Å™„Åï„ÅÑ" },
        { en: "Good morning", ja: "„Åä„ÅØ„Çà„ÅÜ" },
        { en: "Good night", ja: "„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ" },
        { en: "Nice to meet you", ja: "„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶" },
        { en: "How are you?", ja: "„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü" },
        { en: "Please", ja: "„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô" },
        { en: "my", ja: "ÁßÅ„ÅÆ" },
        { en: "me", ja: "ÁßÅ„Çí" },
        { en: "mine", ja: "ÁßÅ„ÅÆ„ÇÇ„ÅÆ" },
        { en: "yours", ja: "„ÅÇ„Å™„Åü„ÅÆ„ÇÇ„ÅÆ" },
        { en: "his", ja: "ÂΩº„ÅÆ" },
        { en: "she", ja: "ÂΩºÂ•≥" },
        { en: "her", ja: "	ÂΩºÂ•≥„ÅÆ" },
        { en: "hers", ja: "ÂΩºÂ•≥„ÅÆ„ÇÇ„ÅÆ" },
        { en: "it", ja: "„Åù„Çå" },
        { en: "its", ja: "„Åù„Çå„ÅÆ" },
        { en: "they", ja: "ÂΩº„Çâ„ÄÅ„Åù„Çå„Çâ" },
        { en: "their", ja: "ÂΩº„Çâ„ÅÆ„ÄÅ„Åù„Çå„Çâ„ÅÆ" },
        { en: "them", ja: "ÂΩº„Çâ„Çí„ÄÅ„Åù„Çå„Çâ„Çí" },
        { en: "theirs", ja: "ÂΩº„Çâ„ÅÆ„ÇÇ„ÅÆ„ÄÅ„Åù„Çå„Çâ„ÅÆ„ÇÇ„ÅÆ" },
        { en: "we", ja: "ÁßÅ„Åü„Å°" },
        { en: "our", ja: "	ÁßÅ„Åü„Å°„ÅÆ" },
        { en: "us", ja: "ÁßÅ„Åü„Å°„Çí" },
        { en: "ours", ja: "ÁßÅ„Åü„Å°„ÅÆ„ÇÇ„ÅÆ" },
        { en: "what", ja: "‰Ωï" },
        { en: "what color", ja: "‰ΩïËâ≤" },
        { en: "what sports", ja: "‰Ωï„ÅÆ„Çπ„Éù„Éº„ÉÑ" },
        { en: "wahat subject", ja: "‰Ωï„ÅÆÁßëÁõÆ" },
         { en: "what day is it today ?", ja: "‰ªäÊó•„ÅØ‰ΩïÊõúÊó•Ôºü" },
          { en: "what's your favorite ~ ? ", ja: "„ÅÇ„Å™„Åü„ÅÆÂ•Ω„Åç„Å™ÔΩû„ÅØ„Å™„Çì„Åß„Åô„ÅãÔºü" },
           { en: "where", ja: "„Å©„Åì" },
            { en: "when", ja: "„ÅÑ„Å§" },
             { en: "who", ja: "Ë™∞" },
      { en: "whose", ja: "Ë™∞„ÅÆ" },
       { en: "which", ja: "„Å©„Å°„Çâ„ÅÆ" },
        { en: "how", ja: "„Å©„ÅÜ„ÇÑ„Å£„Å¶" },
         { en: "How do you get to ~ ?", ja: "„Å©„ÅÜ„ÇÑ„Å£„Å¶ÔΩû„Å∏Ë°å„Åç„Åæ„Åô„ÅãÔºü" },
          { en: "How are you?", ja: "ÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü" },
           { en: "How old", ja: "‰ΩïÊ≠≥" },
            { en: "How much", ja: "„ÅÑ„Åè„Çâ" },
              { en: "How many ?", ja: "„ÅÑ„Åè„Å§" },  
       { en: "How about ~ ?", ja: "ÔΩû„ÅØ„Å©„ÅÜ„Åß„Åô„ÅãÔºü" },  
         { en: "how tall", ja: "„Å©„ÅÆ„Åè„Çâ„ÅÑ„ÅÆÈ´ò„Åï" },  
           { en: "how long", ja: "„Å©„ÅÆ„Åè„Çâ„ÅÑ„ÅÆÈï∑„Åï" },  
             { en: "one o'clock", ja: "1ÊôÇ" },  
               { en: "two o'clock", ja: "2ÊôÇ" },  
                 { en: "three o'clock", ja: "3ÊôÇ" },                   
       { en: "four o'clock", ja: "4ÊôÇ" },  
         { en: "five o'clock", ja: "5ÊôÇ" },  
           { en: "six o'clock", ja: "6ÊôÇ" },  
             { en: "seven o'clock", ja: "7ÊôÇ" },
               { en: "eight o'clock", ja: "8ÊôÇ" },
        { en: "nine o'clock", ja: "9ÊôÇ" },
          { en: "ten o'clock", ja: "10ÊôÇ" },
            { en: "eleven o'clock", ja: "11ÊôÇ" },
              { en: "twelve o'clock", ja: "12ÊôÇ" },
                { en: "minute", ja: "ÂàÜ" },
       { en: "hour", ja: "ÊôÇÈñì" },
         { en: "day", ja: "Êó•" },
           { en: "week", ja: "ÈÄ±" },
             { en: "month", ja: "Êúà" },
               { en: "year", ja: "Âπ¥" },
                 { en: "today", ja: "‰ªäÊó•" },
       { en: "weekend", ja: "ÈÄ±Êú´" },
         { en: "morning", ja: "Êúù/ÂçàÂâç‰∏≠" },
           { en: "afternoon", ja: "ÂçàÂæå" },
             { en: "evening", ja: "Êô©" },
               { en: "night", ja: "Â§ú" },
       { en: "midnight", ja: "Ê∑±Â§ú" },
         { en: "birthday", ja: "Ë™ïÁîüÊó•" },
           { en: "Monday", ja: "ÊúàÊõúÊó•" },
             { en: "Tuesday", ja: "ÁÅ´ÊõúÊó•" },
               { en: "Wednesday", ja: "Ê∞¥ÊõúÊó•" },
       { en: "Thursday", ja: "Êú®ÊõúÊó•" },
         { en: "Friday", ja: "ÈáëÊõúÊó•" },
           { en: "Saturday", ja: "ÂúüÊõúÊó•" },
             { en: "Sunday", ja: "Êó•ÊõúÊó•" },
               { en: "January", ja: "1Êúà" },
                 { en: "February", ja: "2Êúà" },
       { en: "March", ja: "3Êúà" },
         { en: "April", ja: "4Êúà" },
           { en: "May", ja: "5Êúà" },
             { en: "June", ja: "6Êúà" },
               { en: "July", ja: "7Êúà" },
                 { en: "August", ja: "8Êúà" },
        { en: "September", ja: "9Êúà" },
          { en: "October", ja: "10Êúà" },
            { en: "November", ja: "11Êúà" },
              { en: "December", ja: "12Êúà" },
     { en: "spring", ja: "Êò•" },   
     { en: "summer", ja: "Â§è" },   
     { en: "automn", ja: "Áßã" },   
     { en: "fall", ja: "Áßã" },   
     { en: "winter", ja: "ÂÜ¨" },   
     { en: "Japan", ja: "Êó•Êú¨" },   
     { en: "America", ja: "„Ç¢„É°„É™„Ç´" },   
     { en: "Canada", ja: "„Ç´„Éä„ÉÄ" },   
     { en: "Australia", ja: "„Ç™„Éº„Çπ„Éà„É©„É™„Ç¢" },   
     { en: "Spain", ja: "„Çπ„Éö„Ç§„É≥" },   
     { en: "China", ja: "‰∏≠ÂõΩ" },   
     { en: "France", ja: "„Éï„É©„É≥„Çπ" },   
     { en: "Germany", ja: "„Éâ„Ç§„ÉÑ" },   
     { en: "Brazil", ja: "„Éñ„É©„Ç∏„É´" },   
     { en: "country", ja: "ÂõΩ" },   
     { en: "Africa", ja: "„Ç¢„Éï„É™„Ç´" },   
     { en: "Asia", ja: "„Ç¢„Ç∏„Ç¢" },   
     { en: "Europe", ja: "„É®„Éº„É≠„ÉÉ„Éë" },   
     { en: "place", ja: "Â†¥ÊâÄ" },   
     { en: "station", ja: "ÈßÖ" },   
     { en: "airport", ja: "Á©∫Ê∏Ø" },   
     { en: "park", ja: "ÂÖ¨Âúí" },   
     { en: "cityhall", ja: "Â∏ÇÂΩπÊâÄ" },   
     { en: "hospital", ja: "ÁóÖÈô¢" },   
     { en: "post office", ja: "ÈÉµ‰æøÂ±Ä" },   
     { en: "store", ja: "Â∫ó" },   
     { en: "supermarket", ja: "„Çπ„Éº„Éë„Éº" },   
     { en: "mountain", ja: "Â±±" },   
     { en: "sea", ja: "Êµ∑" },   
     { en: "restaurant", ja: "„É¨„Çπ„Éà„É©„É≥" },   
     { en: "home", ja: "ÂÆ∂/ÊïÖÈÉ∑" },   
     { en: "house", ja: "‰∏ÄËªíÂÆ∂" },   
     { en: "room", ja: "ÈÉ®Â±ã" },   
     { en: "bedroom", ja: "ÂØùÂÆ§" },   
     { en: "kitchen", ja: "Âè∞ÊâÄ" },   
     { en: "bathroom", ja: "Ôºà„Éà„Ç§„É¨„Å§„Åç„ÅÆÔºâ„ÅäÈ¢®ÂëÇ" },   
     { en: "classroom", ja: "ÊïôÂÆ§" },   
     { en: "gym", ja: "‰ΩìËÇ≤È§®" },   
     { en: "sunny", ja: "Êô¥„Çå„Å¶„ÅÑ„Çã" }, 
     { en: "cloudy", ja: "Êõá„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "rainy", ja: "Èõ®„ÅåÈôç„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "snowy", ja: "Èõ™„ÅåÈôç„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "foggy", ja: "Èúß„Åå„Åã„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "windy", ja: "È¢®„ÅåÂº∑„ÅÑ" }, 
     { en: "sunshine", ja: "Êô¥Â§©" }, 
     { en: "cloud", ja: "Èõ≤" }, 
     { en: "rain", ja: "Èõ®/Èõ®„ÅåÈôç„Çã" }, 
     { en: "shower", ja: "Èõ®/„Å´„Çè„ÅãÈõ®" }, 
     { en: "snow", ja: "Èõ™/Èõ™„ÅåÈôç„Çã" }, 
     { en: "fog", ja: "Èúß" }, 
     { en: "clearup", ja: "Êô¥„Çå„Çã" }, 
     { en: "boy", ja: "Áî∑„ÅÆÂ≠ê" }, 
     { en: "children", ja: "Â≠ê„Å©„ÇÇ„Åü„Å°" }, 
     { en: "dancer", ja: "„Åä„Å©„Çã‰∫∫" }, 
      { en: "driver", ja: "ÈÅãËª¢Êâã" }, 
     { en: "doctor", ja: "ÂåªËÄÖ/ÂçöÂ£´" }, 
     { en: "friend", ja: "Âèã„Å†„Å°" }, 
     { en: "girl", ja: "Â•≥„ÅÆÂ≠ê" }, 
     { en: "job", ja: "‰ªï‰∫ã" }, 
     { en: "man", ja: "Áî∑ÊÄß" }, 
     { en: "officer", ja: "Ë≠¶ÂÆò/ÂΩπ‰∫∫" }, 
     { en: "parent", ja: "Ë¶™" }, 
     { en: "brother", ja: "ÂÖÑÂºü" }, 
     { en: "sister", ja: "ÂßâÂ¶π" }, 
     { en: "grandfather", ja: "„Åä„Åò„ÅÑ„Åï„Çì" }, 
     { en: "grandmother", ja: "	„Åä„Å∞„ÅÇ„Åï„Çì" }, 
     { en: "cousin", ja: "„ÅÑ„Å®„Åì" }, 
     { en: "person", ja: "‰∫∫" },
      { en: "people", ja: "‰∫∫„ÄÖ" }, 
     { en: "woman", ja: "Â•≥ÊÄß" }, 
     { en: "worker", ja: "ÂÉç„Åè‰∫∫" }, 
     { en: "basketball", ja: "„Éê„Çπ„Ç±„ÉÉ„Éà„Éú„Éº„É´" }, 
     { en: "badminton", ja: "„Éê„Éâ„Éü„É≥„Éà„É≥" }, 
     { en: "tabletennis", ja: "ÂçìÁêÉ" }, 
     { en: "swimming", ja: "Ê∞¥Ê≥≥" }, 
     { en: "marathon", ja: "„Éû„É©„ÇΩ„É≥" }, 
     { en: "dinner", ja: "Â§ïÈ£ü" }, 
     { en: "month", ja: "Êúà" }, 
     { en: "color", ja: "Ëâ≤" }, 
     { en: "family", ja: "ÂÆ∂Êóè" }, 
     { en: "flower", ja: "Ëä±" }, 
     { en: "fruit", ja: "ÊûúÁâ©" },  
     { en: "drink", ja: "È£≤„ÅøÁâ©" },  
        { en: "name", ja: "ÂêçÂâç" },  
        { en: "dictionary", ja: "ËæûÊõ∏" },  
        { en: "passport", ja: "„Éë„Çπ„Éù„Éº„Éà" },  
            { en: "homework", ja: "ÂÆøÈ°å" },  
            { en: "food", ja: "È£ü„ÅπÁâ©" },  
    { en: "animal", ja: "ÂãïÁâ©" },
    { en: "box", ja: "ÁÆ±" },   
    { en: "watch", ja: "ËÖïÊôÇË®à" },
    { en: "blackboard", ja: "ÈªíÊùø" },
    { en: "tea", ja: "„ÅäËå∂" },
    { en: "calendar", ja: "„Ç´„É¨„É≥„ÉÄ„Éº" },
    { en: "shoes", ja: "Èù¥" },
    { en: "umbrella", ja: "„Åã„Åï" },
     { en: "newspaper", ja: "Êñ∞ËÅû" },
    { en: "window", ja: "Á™ì" },
    { en: "hair", ja: "È´™" },
    { en: "diary", ja: "Êó•Ë®ò" },
     { en: "letter", ja: "ÊâãÁ¥ô" },
    { en: "wall", ja: "Â£Å" },
    { en: "bird", ja: "È≥•" },
    { en: "doll", ja: "‰∫∫ÂΩ¢" },
     { en: "grape", ja: "„Å∂„Å©„ÅÜ" },
    { en: "camera", ja: "„Ç´„É°„É©" },
    { en: "mouth", ja: "Âè£" },
    { en: "coin", ja: "Á°¨Ë≤®" },
     { en: "song", ja: "Êõ≤" },
    { en: "music", ja: "Èü≥Ê•Ω" },
    { en: "garden", ja: "Â∫≠" },
    { en: "idea", ja: "ËÄÉ„Åà/ÊÑèË¶ã" },
     { en: "art", ja: "Ëä∏Ë°ì" },
    { en: "number", ja: "Êï∞/Áï™Âè∑" },
    { en: "history", ja: "Ê≠¥Âè≤" },
    { en: "story", ja: "Áâ©Ë™û/Ë©±" },
     { en: "subject", ja: "	ÁßëÁõÆ" },
    { en: "plane", ja: "È£õË°åÊ©ü" },
    { en: "bread", ja: "„Éë„É≥" },
    { en: "dish", ja: "Áöø" },
     { en: "tree", ja: "Êú®" },
    { en: "fish", ja: "È≠ö" },
    { en: "like", ja: "ÔΩû„ÅåÂ•Ω„Åç" },
    { en: "have", ja: "ÔΩû„ÇíÊåÅ„Å£„Å¶„ÅÑ„Çã" },
     { en: "play", ja: "ÔºàÊ•ΩÂô®„ÇíÔºâÊºîÂ•è„Åô„ÇãÔºà„Ç≤„Éº„É†„ÇíÔºâ„Éó„É¨„Ç§„Åô„Çã" },
    { en: "watch", ja: "Ôºà„ÉÜ„É¨„Éì„Å™„Å©ÔºâË¶ã„Çã" },
    { en: "want", ja: "ÔΩû„ÅåÊ¨≤„Åó„ÅÑ" },
    { en: "eat", ja: "ÔΩû„ÇíÈ£ü„Åπ„Çã" },
     { en: "read", ja: "ÔΩû„ÇíË™≠„ÇÄ" },
    { en: "see", ja: "ÔΩû„ÇíË¶ã„Çã" },
    { en: "make", ja: "ÔΩû„Çí„Å§„Åè„Çã" },
    { en: "come", ja: "Êù•„Çã" },
     { en: "study", ja: "ÂãâÂº∑„Åô„Çã" },
    { en: "get", ja: "ÔΩû„ÇíÊåÅ„Å§/Êâã„Å´ÂÖ•„Çå„Çã" },
    { en: "take", ja: "ÔΩû„Çí„Å®„Çã" },
    { en: "write", ja: "ÔΩû„ÇíÊõ∏„Åè" },
     { en: "work", ja: "ÂÉç„Åè" },
    { en: "use", ja: "ÔΩû„Çí‰Ωø„ÅÜ" },
    { en: "drink", ja: "ÔΩû„ÇíÈ£≤„ÇÄ" },
    { en: "wash", ja: "ÔΩû„ÇíÊ¥ó„ÅÜ" },
     { en: "cook", ja: "ÔΩû„ÇíÊñôÁêÜ„Åô„Çã" },
    { en: "speak	", ja: "ÔΩû„ÇíË©±„Åô" },
    { en: "run", ja: "Ëµ∞„Çã" },
    { en: "sleep", ja: "ÂØù„Çã" },
     { en: "buy", ja: "ÔΩû„ÇíË≤∑„ÅÜ" },
    { en: "open", ja: "ÔΩû„ÇíÈñã„Åë„Çã„ÉªÈñã„Åè" },
    { en: "swim", ja: "Ê≥≥„Åê" },
     { en: "listen", ja: "ËÅ¥„Åè" },
    { en: "look", ja: "Ë¶ã„Çã" },
    { en: "sing", ja: "Ê≠å„ÅÜ" },
     { en: "know", ja: "ÔΩû„ÇíÁü•„Çã" },
    { en: "sit", ja: "Â∫ß„Çã" },
    { en: "clean", ja: "ÔΩû„ÇíÊéÉÈô§„Åô„Çã" },
     { en: "help", ja: "Âä©„Åë„Çã" },
    { en: "meet", ja: "ÔΩû„Å´‰ºö„ÅÜ" },
    { en: "walk", ja: "Ê≠©„Åè" },
     { en: "ski", ja: "„Çπ„Ç≠„Éº„Çí„Åô„Çã" },
    { en: "start", ja: "Âßã„ÇÅ„Çã" },
    { en: "talk", ja: "Ë©±„Åô" },
     { en: "teach", ja: "Êïô„Åà„Çã" },
    { en: "think", ja: "ËÄÉ„Åà„Çã" },
    { en: "need", ja: "ÔΩû„ÅåÊ¨≤„Åó„ÅÑ" },
     { en: "close", ja: "ÔΩû„ÇíÈñâ„ÇÅ„Çã" },
    { en: "give", ja: "ÔΩû„Çí„ÅÇ„Åí„Çã„Éª‰∏é„Åà„Çã" },
    { en: "stop", ja: "Ê≠¢„Åæ„Çã" },
     { en: "dance", ja: "„ÉÄ„É≥„Çπ„Åô„Çã" },
    { en: "love", ja: "ÊÑõ„Åô„Çã" },
    { en: "live", ja: "Áîü„Åç„Çã/‰Ωè„ÇÄ" },
     { en: "stand", ja: "Á´ã„Å§" },
    { en: "wait", ja: "ÂæÖ„Å§" },
    { en: "put", ja: "ÔΩû„ÇíÁΩÆ„Åè" },
     { en: "brush", ja: "„Éñ„É©„Ç∑„Çí„Åã„Åë„Çã" },
    { en: "ride", ja: "‰πó„Çã" },
    { en: "camp", ja: "„Ç≠„É£„É≥„Éó„Çí„Åô„Çã" },
     { en: "learn", ja: "ÔΩû„ÇíÁøí„ÅÜ/Â≠¶„Å∂" },
    { en: "smile	", ja: "Á¨ë„ÅÜ" },
    { en: "begin", ja: "Âßã„ÇÅ„Çã" },
     { en: "enjoy", ja: "ÔΩû„ÇíÊ•Ω„Åó„ÇÄ" },
    { en: "practice", ja: "Á∑¥Áøí„Åô„Çã" },
    { en: "drive", ja: "ÔΩû„ÇíÈÅãËª¢„Åô„Çã" },
     { en: "ask", ja: "„ÅäÈ°ò„ÅÑ„Åô„Çã" },
    { en: "tell", ja: "ÔΩû„ÇíË®Ä„ÅÜ" },
    { en: "fly", ja: "È£õ„Å∂" },
     { en: "jump", ja: "„Ç∏„É£„É≥„Éó„Åô„Çã" },
    { en: "stay", ja: "„Å®„Å©„Åæ„Çã" },
    { en: "move", ja: "Âãï„Åè" },
     { en: "turn", ja: "Âõû„Çã" },
    { en: "visit", ja: "ÔΩû„ÇíË®™„Å≠„Çã" },
    { en: "try", ja: "ÔΩû„Çí„ÇÑ„Å£„Å¶„Åø„Çã" },
    ];

    let currentActiveList = [], currentIndex = 0, score = 0, isChecking = false;
    let currentMode = 'choice', isTimeTrial = false, timerInterval = null, timeLeft = 600;

    function shuffle(array) {
        let arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function changeMode(mode) {
        currentMode = mode;
        const opts = document.querySelectorAll('.mode-option');
        opts[0].classList.toggle('active', mode === 'choice');
        opts[1].classList.toggle('active', mode === 'spell');
        opts[2].classList.toggle('active', mode === 'listen');
        updateHighScoreDisplay();
        resetProgress();
    }

    function toggleTimeTrial() {
        isTimeTrial = !isTimeTrial;
        document.getElementById('timer').style.visibility = isTimeTrial ? 'visible' : 'hidden';
        document.getElementById('time-tri-btn').classList.toggle('active');
        if(isTimeTrial) startTimer(); else stopTimer();
        resetProgress();
    }

    function startTimer() { stopTimer(); timeLeft = 600; updateTimerText(); timerInterval = setInterval(() => { timeLeft--; updateTimerText(); if(timeLeft <= 0) { stopTimer(); finish("„Çø„Ç§„É†„Ç¢„ÉÉ„ÉóÔºÅ"); } }, 1000); }
    function stopTimer() { clearInterval(timerInterval); }
    function updateTimerText() { const m = Math.floor(timeLeft / 60); const s = timeLeft % 60; document.getElementById('timer').textContent = `${m}:${s.toString().padStart(2, '0')}`; }
    function updateHighScoreDisplay() { document.getElementById('high-score').textContent = localStorage.getItem(`hs_${currentMode}_${isTimeTrial}`) || 0; }

    function resetProgress() {
        currentActiveList = shuffle(masterWordList);
        currentIndex = 0; score = 0;
        document.getElementById('score').textContent = "0";
        showQuestion();
    }

    function showQuestion() {
        if (currentIndex >= currentActiveList.length) {
            if(isTimeTrial) { currentActiveList = shuffle(masterWordList); currentIndex = 0; }
            else { finish("ÂÖ®ÂïèÁµÇ‰∫ÜÔºÅ"); return; }
        }
        isChecking = false;
        const q = currentActiveList[currentIndex];
        document.getElementById('feedback').textContent = "";
        document.getElementById('hint-text').textContent = "";
        const display = document.getElementById('target-display');
        const inputArea = document.getElementById('spell-input-area');
        const optionsArea = document.getElementById('options');
        const speaker = document.getElementById('speaker-icon');

        if (currentMode === 'spell') {
            display.textContent = q.ja; speaker.style.display = 'none'; inputArea.style.display = 'block'; optionsArea.style.display = 'none';
            const input = document.getElementById('spell-input'); input.value = ""; input.disabled = false; input.focus();
        } else if (currentMode === 'listen') {
            display.textContent = "???"; speaker.style.display = 'flex'; inputArea.style.display = 'none'; optionsArea.style.display = 'grid';
            speak(q.en); setupOptions(q);
        } else {
            display.textContent = q.en; speaker.style.display = 'flex'; inputArea.style.display = 'none'; optionsArea.style.display = 'grid';
            speak(q.en); setupOptions(q);
        }
    }

    function setupOptions(q) {
        const others = masterWordList.filter(w => w.ja !== q.ja);
        const opts = shuffle([q.ja, ...shuffle(others).slice(0, 3).map(w => w.ja)]);
        const container = document.getElementById('options');
        container.innerHTML = '';
        opts.forEach(o => {
            const btn = document.createElement('button');
            btn.className = 'option-btn'; btn.textContent = o;
            btn.onclick = () => check(o === q.ja, btn);
            container.appendChild(btn);
        });
    }

    function check(isCorrect, targetElement = null) {
        if(isChecking) return;
        isChecking = true;
        const q = currentActiveList[currentIndex];
        
        if (currentMode === 'listen') document.getElementById('target-display').textContent = q.en;

        const feedback = document.getElementById('feedback');
        if(isCorrect) {
            if(targetElement) targetElement.classList.add('correct');
            score++; document.getElementById('score').textContent = score;
            feedback.innerHTML = `<span style="color:var(--primary)">‚ú®Ê≠£Ëß£: ${q.en}</span>`;
        } else {
            if(targetElement) targetElement.classList.add('wrong');
            feedback.innerHTML = `<span style="color:var(--time)">‚ùåÊ≠£Ëß£: ${q.en}</span>`;
        }
        
        speak(q.en);
        setTimeout(() => { currentIndex++; showQuestion(); }, isCorrect ? 1000 : 2500);
    }

    function showHint() {
        const q = currentActiveList[currentIndex];
        if(!q) return;
        const hint = q.en[0] + "_".repeat(q.en.length - 2) + q.en.slice(-1);
        document.getElementById('hint-text').textContent = hint;
    }

    // „Éç„Ç§„ÉÜ„Ç£„ÉñÁô∫Èü≥Âº∑Âåñ„ÅÆ„Åü„ÇÅ„ÅÆÈñ¢Êï∞
    function speak(text) {
        if (!('speechSynthesis' in window)) return;
        
        // ÂÜçÁîü‰∏≠„ÅÆÈü≥Â£∞„Çí‰∏ÄÂ∫¶ÂÆåÂÖ®„Å´Ê≠¢„ÇÅ„Çã
        speechSynthesis.cancel();

        const u = new SpeechSynthesisUtterance(text);
        
        // „Éñ„É©„Ç¶„Ç∂„ÅßÂà©Áî®ÂèØËÉΩ„Å™Èü≥Â£∞„É™„Çπ„Éà„ÇíÂèñÂæó
        const voices = speechSynthesis.getVoices();
        
        // „Çà„Çä„Éç„Ç§„ÉÜ„Ç£„Éñ„Å´Ëøë„ÅÑ„ÄåGoogle US English„Äç„ÇÑ„Äå Samantha(iOS)„Äç„ÄåMicrosoft Zira„Äç„Å™„Å©„ÇíÂÑ™ÂÖàÁöÑ„Å´Êé¢„Åô
        const nativeVoice = voices.find(v => 
            v.lang === 'en-US' && (v.name.includes('Google') || v.name.includes('Samantha') || v.name.includes('Premium'))
        ) || voices.find(v => v.lang.startsWith('en'));

        if (nativeVoice) u.voice = nativeVoice;

        u.lang = 'en-US';
        u.rate = 0.85; // Â∞ë„Åó„ÇÜ„Å£„Åè„Çä„Å´„Åô„Çã„Åì„Å®„ÅßËÅû„ÅçÂèñ„Çä„ÇÑ„Åô„Åè
        u.pitch = 1.0; // Ëá™ÁÑ∂„Å™È´ò„Åï
        
        speechSynthesis.speak(u);
    }

    // „Éñ„É©„Ç¶„Ç∂„Å´„Çà„Å£„Å¶„ÅØÈü≥Â£∞„É™„Çπ„Éà„ÅÆÂèñÂæó„Å´ÊôÇÈñì„Åå„Åã„Åã„Çã„Åü„ÇÅ
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }

    function retrySpeak() { if (currentActiveList[currentIndex]) speak(currentActiveList[currentIndex].en); }

    document.getElementById('spell-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') check(document.getElementById('spell-input').value.trim().toLowerCase() === currentActiveList[currentIndex].en.toLowerCase());
    });

    function finish(msg) {
        stopTimer();
        const key = `hs_${currentMode}_${isTimeTrial}`;
        const oldHS = parseInt(localStorage.getItem(key) || 0);
        if(score > oldHS) localStorage.setItem(key, score);
        document.getElementById('game-card').innerHTML = `<h2>${msg}</h2><p style="font-size:1.8rem; color:var(--primary); font-weight:bold;">„Çπ„Ç≥„Ç¢: ${score}</p><p>ÊúÄÈ´òË®òÈå≤: ${Math.max(score, oldHS)}</p><button onclick="location.reload()" class="btn-main">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶</button>`;
    }

    (function init() {
        updateHighScoreDisplay();
        resetProgress();
    })();
    // „Çµ„Éº„Éì„Çπ„ÉØ„Éº„Ç´„Éº„ÅÆÁôªÈå≤
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
    .then(() => console.log("Service Worker Registered"))
    .catch(err => console.log("Service Worker Failed", err));
}
</script>
</body>
</html>